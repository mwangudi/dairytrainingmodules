!function(e,t,n,o){e(function(){var i=e(".ess-social-networks"),s=e(".ess-social-network-rows"),a=e(".ess-social-network-save"),r=n.template("ess-social-network-row"),d=n.template("ess-social-network-row-blank"),l=Backbone.Model.extend({changes:{},logChanges:function(e){var t=this.changes||{};_.each(e,function(e,n){t[n]=_.extend(t[n]||{network_id:n},e)}),this.changes=t,this.trigger("change:networks")},discardChanges:function(e){var t=this.changes||{},n=null,o=_.indexBy(this.get("networks"),"network_id");t[e]&&t[e].network_order!==undefined&&(n=t[e].network_order),delete t[e],null!==n&&o[e]&&o[e].network_order!==n&&(t[e]=_.extend(t[e]||{},{network_id:e,network_order:n})),this.changes=t,0===_.size(this.changes)&&h.clearUnloadConfirmation()},save:function(){_.size(this.changes)?e.post(o+(o.indexOf("?")>0?"&":"?")+"action=easy_social_sharing_social_networks_save_changes",{ess_social_networks_nonce:t.ess_social_networks_nonce,changes:this.changes},this.onSaveResponse,"json"):w.trigger("saved:networks")},onSaveResponse:function(e,n){"success"===n&&(e.success?(w.set("networks",e.data.social_networks),w.trigger("change:networks"),w.changes={},w.trigger("saved:networks")):window.alert(t.strings.save_failed))}}),c=Backbone.View.extend({rowTemplate:r,initialize:function(){this.listenTo(this.model,"change:networks",this.setUnloadConfirmation),this.listenTo(this.model,"saved:networks",this.clearUnloadConfirmation),this.listenTo(this.model,"saved:networks",this.render),s.on("change",{view:this},this.updateModelOnChange),s.on("sortupdate",{view:this},this.updateModelOnSort),e(window).on("beforeunload",{view:this},this.unloadConfirmation),a.on("click",{view:this},this.onSubmit),e(document.body).on("click",".ess-social-network-add",{view:this},this.onAddNewRow)},block:function(){e(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){e(this.el).unblock()},render:function(){var n=_.indexBy(this.model.get("networks"),"network_id"),o=this;this.$el.empty(),this.unblock(),_.size(n)?(n=_.sortBy(n,function(e){return parseInt(e.network_order,10)}),e.each(n,function(e,n){"1"===n.is_api_support?n.api_support_icon='<mark class="yes"><span class="dashicons dashicons-yes tips" data-tip="'+t.strings.yes+'"></span>':n.api_support_icon='<mark class="no"><span class="dashicons dashicons-no-alt tips" data-tip="'+t.strings.no+'"></span>',o.renderRow(n)})):o.$el.append(d),o.initRows()},renderRow:function(e){var t=this;t.$el.append(t.rowTemplate(e)),t.initRow(e)},initRow:function(t){var n=this.$el.find('tr[data-id="'+t.network_id+'"]');n.find("select").each(function(){var n=e(this).data("attribute");e(this).find('option[value="'+t[n]+'"]').prop("selected",!0)}),n.find(".view").show(),n.find(".edit").hide(),n.find(".ess-social-network-edit").on("click",{view:this},this.onEditRow),n.find(".ess-social-network-delete").on("click",{view:this},this.onDeleteRow),n.find(".editing .ess-social-network-edit").trigger("click"),n.find(".ess-social-network-cancel-edit").on("click",{view:this},this.onCancelEditRow),!0===t.editing&&(n.addClass("editing"),n.find(".ess-social-network-edit").trigger("click"))},initRows:function(){0==e("tbody.ess-social-network-rows tr").length%2?i.find("tbody.ess-social-network-rows").next("tbody").find("tr").addClass("odd"):i.find("tbody.ess-social-network-rows").next("tbody").find("tr").removeClass("odd"),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),e(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:50})},onSubmit:function(e){e.data.view.block(),e.data.view.model.save(),e.preventDefault()},onAddNewRow:function(n){n.preventDefault();var o=n.data.view,i=o.model,s=_.indexBy(i.get("networks"),"network_id"),a={},r=_.size(s),d=_.extend({},t.default_social_network,{network_id:"new-"+r+"-"+Date.now(),editing:!0,newRow:!0});e(".ess-social-network-blank-state").closest("tr").remove(),d.network_order=1+_.max(_.pluck(s,"network_order"),function(e){return parseInt(e,10)}),a[d.network_id]=d,i.logChanges(a),o.renderRow(d),o.initRows()},onEditRow:function(t){t.preventDefault(),t.data.view.model.trigger("change:networks"),e(this).closest("tr").addClass("editing"),e(this).closest("tr").find(".view").hide(),e(this).closest("tr").find(".edit").show(),e(document.body).trigger("ess-enhanced-select-init"),e(".tips").tipTip({attribute:"data-disabled-tip",fadeIn:50,fadeOut:50,delay:50})},onCancelEditRow:function(t){var n=t.data.view,o=n.model,i=e(this).closest("tr"),s=e(this).closest("tr").data("id"),a=_.indexBy(o.get("networks"),"network_id");t.preventDefault(),o.discardChanges(s),a[s]&&(a[s].editing=!1,i.after(n.rowTemplate(a[s])),n.initRow(a[s])),i.remove(),n.render(),n.initRows()},onDeleteRow:function(t){var n=t.data.view,o=n.model,i=_.indexBy(o.get("networks"),"network_id"),s={},a=e(this).closest("tr"),r=e(this).closest("tr").data("id");t.preventDefault(),i[r]&&(delete i[r],s[r]=_.extend(s[r]||{},{deleted:"deleted"}),o.set("networks",i),o.logChanges(s)),a.remove(),n.render(),n.initRows()},setUnloadConfirmation:function(){this.needsUnloadConfirm=!0,a.removeAttr("disabled")},clearUnloadConfirmation:function(){this.needsUnloadConfirm=!1,a.attr("disabled",!0)},unloadConfirmation:function(e){if(e.data.view.needsUnloadConfirm)return e.returnValue=t.strings.unload_confirmation_msg,window.event.returnValue=t.strings.unload_confirmation_msg,t.strings.unload_confirmation_msg},updateModelOnChange:function(t){var n=t.data.view.model,o=e(t.target),i=o.closest("tr").data("id"),s=o.closest("tr").find(".ess-social-network-name option:selected").val(),a=o.closest("tr").find(".socicon"),r=o.data("attribute"),d=o.val(),l=_.indexBy(n.get("networks"),"network_id"),c={};l[i]&&l[i][r]===d||(c[i]={},c[i][r]=d),a.removeClass(function(e,t){return(t.match(/(^|\s)socicon-\S+/g)||[]).join(" ")}),a.addClass("socicon-"+s),n.logChanges(c)},updateModelOnSort:function(t){var n=t.data.view.model,o=_.indexBy(n.get("networks"),"network_id"),i=e("tbody.ess-social-network-rows tr"),s={};_.each(i,function(t){var n=e(t).data("id"),i=null,a=parseInt(e(t).index(),10);o[n]&&(i=parseInt(o[n].network_order,10)),i!==a&&(s[n]=_.extend(s[n]||{},{network_order:a}))}),_.size(s)&&n.logChanges(s)}}),w=new l({networks:t.networks}),h=new c({model:w,el:s});h.render(),s.sortable({items:"tr",cursor:"move",axis:"y",handle:"td.ess-social-network-sort",scrollSensitivity:40})})}(jQuery,socialNetworksLocalizeScript,wp,ajaxurl);